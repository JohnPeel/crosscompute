{% extends 'base.jinja2' if IS_STATIC else 'live.jinja2' %}

{#
{% block header_html %}
<a href="{{ BASE_URI if BASE_URI else '/' }}">Root</a> &gt;
<a href="{{ BASE_URI }}{{ automation_definition['uri'] }}">{{ automation_definition['name'] }}</a> &gt;
<a>{{ page_definition['name'] }}</a> &gt;
<a href="{{ BASE_URI }}{{ uri }}">{{ page_type_name }}</a>
{% endblock %}
#}

{% block body_html -%}
{{ super() }}
{% if page_type_name == 'input' %}
<button id="run">Run</button>
{% endif %}
{%- endblock %}

{%- block body_js -%}
{{ super() }}
{% if page_type_name == 'input' %}
const GET_DATA_BY_VIEW_NAME = {
  number: e => e.value,
}
document.getElementById('run').onclick = async () => {
  const dataById = {}
  for (const e of document.getElementsByClassName('input')) {
    const classNames = e.classList
    const viewName = classNames[1]
    const variableId = classNames[2]
    const variableData = GET_DATA_BY_VIEW_NAME[viewName](e)
    dataById[variableId] = variableData
  }
  const response = await fetch('{{ BASE_URI }}{{ automation_definition['uri'] }}.json', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(dataById),
  })
  const responseJSON = await response.json()
  console.log(responseJSON)
  window.location = '{{ BASE_URI }}{{ automation_definition['uri'] }}/r/' + responseJSON['id'] + '/o'
}
{% endif %}
{%- endblock -%}
