{% extends 'page.jinja2' %}
{% from 'type.jinja2' import render_values with context %}
{% set result_name = result_name or '%s %s' % (result_id, result_title) %}

{% block page_title %}
{% block body_subtitle %}{{ result_name }}{% endblock %} &middot; Results &middot; {{ website_name -}}
{% endblock %}

{% block head_style_inline %}
.download {margin-top: 2em}
{{ super() -}}
{% endblock %}

{% block body_content %}
{{ super() -}}
{% if result_arguments %}
<h2>Arguments</h2>
<div id="result_arguments">
{{ render_values(result_arguments) -}}
</div>
{% endif -%}

{% if result_properties -%}

{% set standard_errors = result_properties.pop('standard_errors', {}) %}
{% set type_errors = result_properties.pop('type_errors', {}) %}
{% if standard_errors or type_errors %}
<h2>Errors</h2>
<div class="error">
{{ render_values(standard_errors) -}}
{{ render_values(type_errors) -}}
</div>
{% endif -%}

{% set standard_outputs = result_properties.pop('standard_outputs', {}) %}
{% if standard_outputs %}
<h2>Outputs</h2>
<div id="standard-outputs">
{% for content_type, content in result_template_packs %}

{%- if content_type == 0 -%}
{% set result_property_name = content %}
{% set result_property_value = standard_outputs.get(result_property_name) %}

{% if result_property_value is not none %}
{% set data_type = get_data_type_for(result_property_name) %}
{% if not data_type.match(result_property_value) %}
{% set data_type = default_data_type %}
{% endif -%}
{% from data_type.template import render_value with context %}
{{- render_value(result_property_name, result_property_value) -}}
{% endif %}

{%- elif content_type == 1 -%}
{{ content | markdown }}

{%- endif -%}
{% else %}
{{ render_values(standard_outputs) -}}
{% endfor %}
</div>
{% endif -%}

<h2>Properties</h2>
<div id="result_properties">
{{ render_values(result_properties) -}}
</div>
<a href="{{ request.route_path('result.zip', id=result_id, name=result_name) }}" class="btn btn-success download" role="button" download>Download</a>
{% endif %}
{% endblock %}
