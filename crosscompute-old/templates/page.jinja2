{% extends 'base.jinja2' if IS_STATIC else 'live.jinja2' %}

{#
{% block header_html %}
<a href="{{ BASE_URI if BASE_URI else '/' }}">Root</a> &gt;
<a href="{{ BASE_URI }}{{ automation_definition['uri'] }}">{{ automation_definition['name'] }}</a> &gt;
<a>{{ batch_definition['name'] }}</a> &gt;
<a href="{{ BASE_URI }}{{ uri }}">{{ page_type_name }}</a>
{% endblock %}
#}

{% block body_html -%}
{%- if page_type_name == 'input' -%}
<form id="automation">
{%- endif %}
{{ super() }}
{% if page_type_name == 'input' -%}
<button>Run</button>
</form>
{%- endif -%}
{%- endblock %}

{%- block body_js -%}
{{ super() }}
{% if page_type_name == 'input' -%}
document.getElementById('automation').onsubmit = async (e) => {
  e.preventDefault()
  const url = '{{ BASE_URI }}{{ automation_definition['uri'] }}.json'
  const response = await fetch(url, {
    method: 'POST',
    body: new FormData(e.target)
  })
  const d = await response.json()
  window.location = '{{ BASE_URI }}{{ automation_definition['uri'] }}/r/' + d['id'] + '/o'
}
{% endif -%}
{%- endblock -%}
